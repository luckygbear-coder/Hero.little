<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å°å‹‡è€…ä¹‹æ—…å¤§å†’éšª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #ffeec9;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .game-wrap {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    .card {
      background: #fff7e6;
      border-radius: 16px;
      border: 2px solid #e1b676;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
      padding: 16px;
    }

    h1, h2, h3 {
      margin: 0 0 8px;
      color: #8b4a24;
    }

    h1 {
      text-align: center;
      font-size: 26px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #c07a34;
      margin-bottom: 8px;
    }

    /* ğŸ”¹ æ¨¡å¼é¸æ“‡ï¼ˆå–®äºº / åŒæ©Ÿé›™äººï¼‰ */
    .mode-select-wrap {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }
    .mode-btn {
      flex: 1;
      border: none;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 14px;
      background: #f7dcb0;
      color: #5a3218;
      font-weight: 600;
      cursor: pointer;
    }
    .mode-btn.active {
      background: #ffb54a;
      color: #4a260f;
      box-shadow: 0 0 0 2px #fff7e6;
    }
    .mode-banner {
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 999px;
      background: #fff1cf;
      border: 1px dashed #e1b676;
      color: #7a5635;
      margin-bottom: 10px;
      text-align: center;
    }

    /* ä¸»é¸å–®æŒ‰éˆ•åˆ— */
    .nav-tabs {
      display: flex;
      gap: 6px;
      margin: 10px 0 14px;
      overflow-x: auto;
    }
    .nav-btn {
      flex: 1;
      white-space: nowrap;
      border: none;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 14px;
      background: #f5d29a;
      color: #5a3218;
      font-weight: 600;
      cursor: pointer;
    }
    .nav-btn.active {
      background: #ffb54a;
      color: #4a260f;
      box-shadow: 0 0 0 2px #fff7e6;
    }

    /* åˆ†é å…§å®¹ */
    .page {
      display: none;
      animation: fadeIn .2s ease-out;
    }
    .page.active {
      display: block;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(4px);}
      to   {opacity: 1; transform: translateY(0);}
    }

    p {
      line-height: 1.8;
      font-size: 14px;
      color: #5a4637;
      margin: 4px 0;
    }

    ul {
      padding-left: 20px;
      margin: 4px 0;
      color: #5a4637;
      font-size: 14px;
      line-height: 1.8;
    }

    .center {
      text-align: center;
    }

    .primary-btn {
      display: inline-block;
      border: none;
      border-radius: 999px;
      padding: 10px 28px;
      font-size: 16px;
      font-weight: 700;
      background: #ff8b4a;
      color: #fff;
      margin-top: 10px;
      box-shadow: 0 3px 0 #c8662b;
      cursor: pointer;
    }
    .primary-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 #c8662b;
    }

    .tip-box {
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #fff1cf;
      border: 1px dashed #e1b676;
      font-size: 13px;
      color: #7a5635;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: #7a7a7a;
    }

    /* å°å‹‡è€…å¡ç‰‡ */
    .hero-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }
    .hero-card {
      border-radius: 14px;
      border: 2px solid #e1b676;
      background: #fffaf0;
      padding: 8px;
      font-size: 13px;
      cursor: pointer;
      position: relative;
    }
    .hero-card h4 {
      margin: 0 0 4px;
      font-size: 14px;
      color: #7c3e1d;
    }
    .hero-tag {
      font-size: 12px;
      color: #c07a34;
      margin-bottom: 2px;
    }
    .hero-card p {
      font-size: 12px;
      margin: 2px 0;
    }
    .hero-card.active {
      border-color: #ff8b4a;
      box-shadow: 0 0 0 2px #ffe5c5;
    }
    .hero-badge {
      position: absolute;
      right: 6px;
      top: 6px;
      font-size: 11px;
      background: #ffb54a;
      color: #4a260f;
      padding: 2px 6px;
      border-radius: 999px;
    }

    .current-hero {
      margin-top: 8px;
      font-size: 13px;
      color: #5a4637;
      padding: 6px 8px;
      border-radius: 10px;
      background: #fff1cf;
    }

    /* ä¹å®®æ ¼åœ°åœ– */
    .map-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      margin-top: 8px;
    }
    .map-cell {
      border-radius: 12px;
      border: 2px solid #d4b073;
      background: linear-gradient(135deg, #ffeec9, #fffaf0);
      padding: 6px 6px 8px;
      font-size: 12px;
      cursor: pointer;
      position: relative;
      min-height: 70px;
    }
    .map-cell h4 {
      margin: 0 0 2px;
      font-size: 13px;
      color: #7b3c1e;
    }
    .map-cell p {
      font-size: 11px;
      margin: 0;
      line-height: 1.4;
    }
    .map-cell span.tag {
      display: inline-block;
      margin-top: 3px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #ffcf73;
      color: #4a260f;
      font-size: 10px;
    }
    .map-cell.active {
      border-color: #ff8b4a;
      box-shadow: 0 0 0 2px #ffe5c5;
      background: linear-gradient(135deg, #ffe2ad, #fff7de);
    }
    .map-cell .pos-label {
      position: absolute;
      right: 4px;
      bottom: 4px;
      font-size: 10px;
      color: #9a6a3a;
      opacity: .9;
    }
    /* é€šé—œæ¨™è¨˜ */
    .cleared-star {
      position: absolute;
      left: 6px;
      bottom: 4px;
      font-size: 10px;
      background: #ffeb8a;
      color: #4a260f;
      padding: 1px 6px;
      border-radius: 999px;
    }

    .current-stage {
      margin-top: 8px;
      font-size: 13px;
      color: #5a4637;
      padding: 6px 8px;
      border-radius: 10px;
      background: #fff1cf;
    }

    /* æ„›çš„åŠ›é‡ï¼å‹‡æ°£æ˜Ÿæ˜Ÿèªå¥ */
    #loveMessage {
      margin-top: 10px;
      font-size: 13px;
      color: #6d3b3b;
      padding: 8px 10px;
      border-radius: 10px;
      background: #ffeef2;
      border: 1px dashed #f1a7b3;
    }
    #courageMessage {
      margin-top: 8px;
      font-size: 13px;
      color: #4a4a24;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f4ffdd;
      border: 1px dashed #c6e484;
    }

    /* æˆ°é¬¥ç•«é¢ */
    .battle-box {
      margin-top: 8px;
      padding: 10px;
      border-radius: 12px;
      background: #fffaf0;
      border: 1px solid #e1b676;
      font-size: 13px;
      color: #5a4637;
    }
    .battle-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-size: 13px;
    }
    .battle-hero, .battle-monster {
      flex: 1;
    }
    .battle-hero b, .battle-monster b {
      color: #7c3e1d;
    }
    .battle-mode-label {
      font-size: 12px;
      color: #c0571e;
      margin-bottom: 4px;
    }
    .bear-tip {
      margin-top: 8px;
      padding: 8px;
      border-radius: 10px;
      background: #e9f5ff;
      border: 1px dashed #7aa7d9;
      font-size: 13px;
      color: #34516f;
    }
    .battle-buttons {
      margin-top: 10px;
      display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .battle-btn {
      min-width: 90px;
      border-radius: 999px;
      border: none;
      padding: 8px 10px;
      font-size: 14px;
      background: #ffd38a;
      color: #4a260f;
      font-weight: 600;
      cursor: pointer;
    }
    .battle-btn.hero-talent {
      background: #ffc25e;
      box-shadow: 0 0 0 2px #fff4cf;
    }
    #battleResult {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #fff;
      border: 1px solid #e1b676;
      font-size: 13px;
      color: #5a4637;
      min-height: 40px;
      white-space: pre-line;
    }
  </style>
</head>
<body>

<div class="game-wrap">
  <div class="card">
    <!-- éŠæˆ²æ¨™é¡Œ -->
    <h1>å°å‹‡è€…ä¹‹æ—…å¤§å†’éšª</h1>
    <div class="subtitle">æƒ…ç·’èˆ‡å‹‡æ°£çš„å¥‡å¹»ä¹‹æ—… âœ¨</div>

    <!-- ğŸ”¹ æ¨¡å¼é¸æ“‡ï¼ˆå–®äºº / åŒæ©Ÿé›™äººï¼‰ -->
    <div class="mode-select-wrap">
      <button class="mode-btn active" data-mode="single">ğŸ® å–®äººå†’éšª</button>
      <button class="mode-btn" data-mode="local2p">ğŸ¤ åŒæ©Ÿé›™äºº</button>
    </div>
    <div class="mode-banner" id="modeBanner">
      ç›®å‰æ¨¡å¼ï¼š<b>å–®äººå†’éšª</b>ï¼ˆä¸€å€‹äººç·´ç¿’èˆ‡é­”ç‰©äº’å‹•ï¼‰
    </div>

    <!-- ä¸»é¸å–® Tabs -->
    <div class="nav-tabs">
      <button class="nav-btn active" data-target="page-hero">é¸æ“‡å°å‹‡è€…</button>
      <button class="nav-btn" data-target="page-home">ä¸»é¸å–®</button>
      <button class="nav-btn" data-target="page-map">åœ°åœ–å†’éšª</button>
      <button class="nav-btn" data-target="page-battle">æˆ°é¬¥</button>
      <button class="nav-btn" data-target="page-story">æ•…äº‹èƒŒæ™¯</button>
      <button class="nav-btn" data-target="page-howto">ç©æ³•æ•™å­¸</button>
      <button class="nav-btn" data-target="page-monsters">é­”ç‰©åœ–é‘‘</button>
      <button class="nav-btn" data-target="page-settings">è¨­å®š / èªªæ˜</button>
    </div>

    <!-- ğŸŒŸ è§’è‰²ä»‹ç´¹ + é¸æ“‡å°å‹‡è€… -->
    <div id="page-hero" class="page active">
      <h3>ğŸŒŸ é¸æ“‡ä½ çš„å°å‹‡è€…</h3>
      <p>
        åœ¨å‡ºç™¼å†’éšªä¹‹å‰ï¼Œå…ˆé¸æ“‡ä½ è¦æ‰®æ¼”çš„å°å‹‡è€…è§’è‰²ã€‚<br>
        æ¯å€‹è·æ¥­éƒ½æœ‰ä¸åŒå€‹æ€§èˆ‡å£é ­ç¦ªï¼Œå¯ä»¥é™ªä½ ä¸€èµ·é¢å°å£æƒ…ç·’é­”ç‰©ã€‚
      </p>

      <div class="hero-grid">
        <!-- æˆ°å£« -->
        <div class="hero-card" data-hero="æˆ°å£«" data-fist="rock" data-line="ã€Œæˆ‘ä¸€å®šæœƒå®ˆè­·å¤§å®¶ï¼ã€">
          <div class="hero-badge">Rock âœŠ</div>
          <h4>ğŸ›¡ï¸ æˆ°å£«</h4>
          <div class="hero-tag">å€‹æ€§ï¼šå‹‡æ•¢ã€æœ‰è²¬ä»»æ„Ÿ</div>
          <p>å£é ­ç¦ªï¼šæˆ‘ä¸€å®šæœƒå®ˆè­·å¤§å®¶ï¼</p>
          <p>èƒ½åŠ›ï¼šå‡ºçŸ³é ­ä¸¦å‹åˆ© â†’ å‚³é” 2 å€å¥½å¿ƒæƒ…ã€‚</p>
        </div>

        <!-- æ³•å¸« -->
        <div class="hero-card" data-hero="æ³•å¸«" data-fist="scissors" data-line="ã€Œå˜¿å˜¿ï½æˆ‘æœ‰æ–°é»å­ï¼ã€">
          <div class="hero-badge">Scissors âœŒï¸</div>
          <h4>ğŸ”® æ³•å¸«</h4>
          <div class="hero-tag">å€‹æ€§ï¼šè°æ˜ã€æœ‰å‰µæ„</div>
          <p>å£é ­ç¦ªï¼šå˜¿å˜¿ï½æˆ‘æœ‰æ–°é»å­ï¼</p>
          <p>èƒ½åŠ›ï¼šå‡ºå‰ªåˆ€ä¸¦å‹åˆ© â†’ å‚³é” 2 å€å¥½å¿ƒæƒ…ã€‚</p>
        </div>

        <!-- ç‰§å¸« -->
        <div class="hero-card" data-hero="ç‰§å¸«" data-fist="paper" data-line="ã€Œåˆ¥æ“”å¿ƒï¼Œæˆ‘ä¾†å¹«ä½ ï½ã€">
          <div class="hero-badge">Paper ğŸ–</div>
          <h4>ğŸ’– ç‰§å¸«</h4>
          <div class="hero-tag">å€‹æ€§ï¼šæº«æŸ”ã€å–„è§£äººæ„</div>
          <p>å£é ­ç¦ªï¼šåˆ¥æ“”å¿ƒï¼Œæˆ‘ä¾†å¹«ä½ ï½</p>
          <p>èƒ½åŠ›ï¼šå‡ºå¸ƒä¸¦å‹åˆ© â†’ å‚³é” 2 å€å¥½å¿ƒæƒ…ã€‚</p>
        </div>

        <!-- å‹‡æ•¢çš„æ‘æ°‘ -->
        <div class="hero-card" data-hero="å‹‡æ•¢çš„æ‘æ°‘" data-fist="any" data-line="ã€Œæˆ‘é›–ç„¶å¹³å‡¡ï¼Œä½†ä¸æ”¾æ£„ï¼ã€">
          <div class="hero-badge">è‡ªç”±æ‹³ âœ¨</div>
          <h4>ğŸŒ¾ å‹‡æ•¢çš„æ‘æ°‘</h4>
          <div class="hero-tag">å€‹æ€§ï¼šæ¨¸å¯¦ã€å …æ¯…</div>
          <p>å£é ­ç¦ªï¼šæˆ‘é›–ç„¶å¹³å‡¡ï¼Œä½†ä¸æ”¾æ£„ï¼</p>
          <p>èƒ½åŠ›ï¼šé­”ç‹æˆ°ä½¿ç”¨ä»»æ„æ‹³ â†’ å³ä½¿è¼¸ä¹Ÿä¸å—å£æƒ…ç·’å½±éŸ¿ã€‚</p>
        </div>
      </div>

      <div id="currentHero" class="current-hero">
        ç›®å‰é¸æ“‡çš„å°å‹‡è€…ï¼š<b>å°šæœªé¸æ“‡</b><br>
        è«‹é»é¸ä¸Šæ–¹ä»»ä¸€è§’è‰²å¡é–‹å§‹å†’éšªã€‚
      </div>

      <div class="center">
        <button class="primary-btn" onclick="goToHome()">
          âœ… é¸å¥½å›‰ï¼Œå‰å¾€ä¸»é¸å–®
        </button>
      </div>
    </div>

    <!-- ğŸ  ä¸»é¸å–®é  -->
    <div id="page-home" class="page">
      <p class="center" id="homeIntro">
        æ­¡è¿ä¾†åˆ°æ˜Ÿæ˜Ÿç‹åœ‹ï¼<br>
        è·Ÿè‘—æ‘é•·ç†Šç†Šï¼Œä¸€èµ·ç”¨å‰ªåˆ€ã€çŸ³é ­ã€å¸ƒçš„åŠ›é‡ï¼Œ<br>
        å¹«é­”ç‰©å€‘æ‰¾å›å¥½å¿ƒæƒ…å§ï¼
      </p>

      <div class="center">
        <button class="primary-btn" onclick="goToMap()">
          ğŸ—ºï¸ å‰å¾€å†’éšªåœ°åœ–
        </button>
      </div>

      <div class="tip-box" id="homeTip">
        ğŸŒŸ å°æç¤ºï¼š<br>
        æŠŠä¹å®®æ ¼å…¨éƒ¨è®Šæˆã€Œâ­ å·²é€šé—œã€ï¼Œ<br>
        å°±æœƒè‡ªå‹•è§£é–æœ€çµ‚é­”ç‹é—œå¡ï¼
      </div>
    </div>

    <!-- ğŸ—ºï¸ ä¹å®®æ ¼åœ°åœ– -->
    <div id="page-map" class="page">
      <h3>ğŸ—ºï¸ å†’éšªåœ°åœ–ï¼ˆä¹å®®æ ¼ï¼‰</h3>
      <p id="mapIntro">
        é¸æ“‡ä¸€å€‹åœ°é»é€²è¡Œæˆ°é¬¥ï¼Œæ¯ä¸€æ ¼éƒ½ä½è‘—ä¸€éš»å£æƒ…ç·’é­”ç‰©ã€‚<br>
        å®‰æ’«æˆåŠŸæœƒç²å¾—ä¸€å¥ã€Œæ„›çš„åŠ›é‡èªå¥ã€ï¼Œ<br>
        ä¸‰æ ¼é€£æˆä¸€ç·šæ™‚ï¼Œé‚„æœƒè§¸ç™¼ã€Œå‹‡æ°£æ˜Ÿæ˜Ÿèªå¥ã€çå‹µã€‚â­<br>
        <b>å…¨éƒ¨ 9 æ ¼é€šé—œå¾Œ â†’ é€²å…¥é­”ç‹é—œå¡ï¼</b>
      </p>

      <div class="map-grid">
        <!-- 1 -->
        <div class="map-cell" data-stage="1" data-monster="å“­å“­å²èŠå§†">
          <h4>æ–°æ‰‹è‰åŸ</h4>
          <p>ä½è‘—æ„›å“­åˆè¿·æƒ˜çš„<br>ã€Œå“­å“­å²èŠå§†ã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå¸ƒ</span>
          <div class="pos-label">1</div>
        </div>

        <!-- 2 -->
        <div class="map-cell" data-stage="2" data-monster="æš´èºç«çƒ">
          <h4>ç†¾ç†±ä¸˜é™µ</h4>
          <p>ä¸€ä¸å°å¿ƒå°±æœƒçˆ†ç‚¸çš„<br>ã€Œæš´èºç«çƒã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå¸ƒ</span>
          <div class="pos-label">2</div>
        </div>

        <!-- 3 -->
        <div class="map-cell" data-stage="3" data-monster="å£å¿ƒæƒ…å—ç“œ">
          <h4>å—ç“œè¾²å ´</h4>
          <p>å˜´å·´å¾ˆå…‡ã€å…¶å¯¦å¾ˆå¯‚å¯çš„<br>ã€Œå£å¿ƒæƒ…å—ç“œã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå¸ƒ</span>
          <div class="pos-label">3</div>
        </div>

        <!-- 4 -->
        <div class="map-cell" data-stage="4" data-monster="å“­å“­è‡è‡">
          <h4>è˜‘è‡æ£®æ—</h4>
          <p>å¸¸å¸¸è¦ºå¾—è‡ªå·±ä¸å¤ å¥½<br>çš„ã€Œå“­å“­è‡è‡ã€ã€‚</p>
          <span class="tag">Paper å¤©è³¦ï¼ä¸èƒ½å‡ºå‰ªåˆ€</span>
          <div class="pos-label">4</div>
        </div>

        <!-- 5 -->
        <div class="map-cell" data-stage="5" data-monster="æ‚²å‚·éª·é«">
          <h4>å¢“åœ’å°ä¸˜</h4>
          <p>ä»¥ç‚ºè‡ªå·±æ²’äººæ„›çš„<br>ã€Œæ‚²å‚·éª·é«ã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå¸ƒ</span>
          <div class="pos-label">5</div>
        </div>

        <!-- 6 -->
        <div class="map-cell" data-stage="6" data-monster="é»é»å²èŠå§†">
          <h4>é»é»æ²¼æ¾¤</h4>
          <p>ç¸½æ˜¯é»ä½ä¸æƒ³æ”¾æ‰‹çš„<br>ã€Œé»é»å²èŠå§†ã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå¸ƒ</span>
          <div class="pos-label">6</div>
        </div>

        <!-- 7 -->
        <div class="map-cell" data-stage="7" data-monster="å…‡æš´ç‹¼äºº">
          <h4>é­”ç‹¼æ£®æ—</h4>
          <p>çœ‹èµ·ä¾†è¶…å…‡ï¼Œå…¶å¯¦æ€•å­¤å–®çš„<br>ã€Œå…‡æš´ç‹¼äººã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå¸ƒ</span>
          <div class="pos-label">7</div>
        </div>

        <!-- 8 -->
        <div class="map-cell" data-stage="8" data-monster="å°æƒ¡é­”">
          <h4>æƒ¡ä½œåŠ‡å±±ä¸˜</h4>
          <p>æ„›æ‰å¼„äººçš„<br>ã€Œå°æƒ¡é­”ã€ã€‚</p>
          <span class="tag">Rock å¤©è³¦ï¼ä¸èƒ½å‡ºå‰ªåˆ€</span>
          <div class="pos-label">8</div>
        </div>

        <!-- 9 -->
        <div class="map-cell" data-stage="9" data-monster="æ†‚é¬±å¹½éˆ">
          <h4>é»‘éœ§é‚Šç•Œ</h4>
          <p>å¾˜å¾Šåœ¨é»‘éœ§é‚Šç·£çš„<br>ã€Œæ†‚é¬±å¹½éˆã€ã€‚</p>
          <span class="tag">Paper å¤©è³¦ï¼ä¸èƒ½å‡ºçŸ³é ­</span>
          <div class="pos-label">9</div>
        </div>
      </div>

      <div id="currentStage" class="current-stage">
        ç›®å‰å°šæœªé¸æ“‡é—œå¡ï¼Œè«‹é»æ“Šä¸€æ ¼åœ°åœ–é–‹å§‹å†’éšªã€‚
      </div>

      <!-- æ„›çš„åŠ›é‡èªå¥é¡¯ç¤ºå€ -->
      <div id="loveMessage">
        ğŸ’— æ„›çš„åŠ›é‡èªå¥ï¼šç•¶ä½ å®‰æ’«ç¬¬ä¸€éš»é­”ç‰©æˆåŠŸæ™‚ï¼Œé€™è£¡æœƒå‡ºç¾ä¸€å¥æº«æš–çš„è©±ã€‚
      </div>

      <!-- å‹‡æ°£æ˜Ÿæ˜Ÿèªå¥é¡¯ç¤ºå€ -->
      <div id="courageMessage">
        â­ å‹‡æ°£æ˜Ÿæ˜Ÿèªå¥ï¼šç•¶ä¸‰æ ¼é€£æˆä¸€ç·šæ™‚ï¼Œé€™è£¡æœƒå‡ºç¾ä¸€é¡†å‹‡æ°£æ˜Ÿæ˜Ÿé€çµ¦ä½ ã€‚
      </div>

      <div class="center">
        <button class="primary-btn" onclick="startGameFromMap()">
          âš”ï¸ é€²å…¥æˆ°é¬¥ï¼
        </button>
      </div>

      <div class="tip-box" id="mapTip">
        å°ä»»å‹™ï¼š<br>
        âœ” æŠŠä¹å®®æ ¼å…¨éƒ¨è®Šæˆ â­ å·²é€šé—œ<br>
        âœ” å°±èƒ½é¢å°å£æƒ…ç·’çš„æºé ­â”€â”€é­”ç‹é»‘éœ§å·¨é¾ï¼
      </div>
    </div>

    <!-- âš”ï¸ æˆ°é¬¥é é¢ï¼ˆä¸€èˆ¬æˆ° + é­”ç‹æˆ°å…±ç”¨ï¼‰ -->
    <div id="page-battle" class="page">
      <h3>âš”ï¸ å°æˆ°ç•«é¢</h3>

      <div class="battle-box">
        <div class="battle-mode-label" id="battleModeLabel">
          æ¨¡å¼ï¼šä¸€èˆ¬é—œå¡
        </div>
        <div class="battle-header">
          <div class="battle-hero">
            ğŸ‘¦ å°å‹‡è€…ï¼š<br>
            <b id="battleHeroName">ï¼ˆå°šæœªé¸æ“‡ï¼‰</b><br>
            <span id="battleHeroTalent">æ‹›ç‰Œæ‹³ï¼šâ€”</span>
          </div>
          <div class="battle-monster">
            ğŸ‘¾ å°æˆ°é­”ç‰©ï¼š<br>
            <b id="battleMonsterName">â€”</b><br>
            <span id="battleMonsterInfo">å¤©è³¦ï¼šâ€”ï¼å¼±é»ï¼šâ€”</span>
          </div>
        </div>

        <div class="bear-tip" id="bearTip">
          ğŸ§¸ æ‘é•·ç†Šç†Šæç¤ºï¼šé¸å¥½åœ°åœ–ä¸Šçš„é—œå¡å¾Œï¼Œé€™è£¡æœƒå‘Šè¨´ä½ é­”ç‰©ä¸èƒ½å‡ºä»€éº¼æ‹³ï¼
        </div>

        <div class="battle-buttons">
          <button class="battle-btn" id="btn-rock" onclick="playerChoose('rock')">âœŠ çŸ³é ­</button>
          <button class="battle-btn" id="btn-scissors" onclick="playerChoose('scissors')">âœŒï¸ å‰ªåˆ€</button>
          <button class="battle-btn" id="btn-paper" onclick="playerChoose('paper')">ğŸ– å¸ƒ</button>
        </div>

        <div id="battleResult">
          é€™è£¡æœƒé¡¯ç¤ºå°æˆ°çµæœèˆ‡å¿ƒæƒ…è®ŠåŒ–ã€‚
        </div>

        <div class="center">
          <button class="primary-btn" onclick="backToMap()">
            â¬… å›åœ°åœ–é¸ä¸‹ä¸€é—œ
          </button>
        </div>
      </div>
    </div>

    <!-- ğŸ“– æ•…äº‹èƒŒæ™¯ -->
    <div id="page-story" class="page">
      <h3>ğŸ“– æ•…äº‹èƒŒæ™¯</h3>
      <p>
        åœ¨é™é çš„ã€Œæ˜Ÿæ˜Ÿç‹åœ‹ã€è£¡ï¼Œæ‰€æœ‰é­”ç‰©åŸæœ¬éƒ½å¿«å¿«æ¨‚æ¨‚åœ°ç”Ÿæ´»è‘—ã€‚
        ç›´åˆ°æŸä¸€å¤©ï¼Œä¸€è‚¡ç¥ç§˜çš„ã€Œå£æƒ…ç·’é»‘éœ§ã€çªç„¶é™è‡¨ï¼Œ
        é­”ç‰©å€‘è¢«å½±éŸ¿å¾—å“­å“­å•¼å•¼ã€æš´èºç”Ÿæ°£ã€å¤±å»ç¬‘å®¹ï¼
      </p>
      <p>
        æ˜Ÿæ˜Ÿç‹åœ‹çš„å­©å­å€‘è¢«é¸ä¸­æˆç‚ºã€Œå°å‹‡è€…ã€ï¼Œ
        åªè¦ç”¨ <b>å‰ªåˆ€ã€çŸ³é ­ã€å¸ƒ</b> çš„å‹‡æ°£ä¹‹åŠ›ï¼Œ
        å°±èƒ½è§£é™¤é­”ç‰©çš„å£æƒ…ç·’ï¼Œè®“ç‰ å€‘å†æ¬¡éœ²å‡ºå¹¸ç¦çš„ç¬‘å®¹ã€‚
      </p>
      <p>
        æ‘é•·ç†Šç†Šæœƒä¸€è·¯é™ªä¼´ä½ ï¼Œæé†’é­”ç‰©çš„å¼±é»ï¼Œ
        å¹«åŠ©ä½ é †åˆ©é€šé—œï¼Œç›´åˆ°æŒ‘æˆ°é»‘éœ§å·¨é¾ã€‚
      </p>
    </div>

    <!-- ğŸ® ç©æ³•æ•™å­¸ -->
    <div id="page-howto" class="page">
      <h3>ğŸ® åŸºæœ¬ç©æ³•</h3>
      <ul>
        <li>èˆ‡é­”ç‰©é€²è¡Œã€Œå‰ªåˆ€ã€çŸ³é ­ã€å¸ƒã€å°æ±ºã€‚</li>
        <li>æ¯éš»é­”ç‰©éƒ½æœ‰ã€Œå¤©è³¦æ‹³ã€èˆ‡ã€Œä¸èƒ½å‡ºçš„å¼±é»æ‹³ã€ã€‚</li>
        <li>å‡ºå°æ‹³ â†’ å‚³éå¥½å¿ƒæƒ…ï¼Œé­”ç‰©æœƒå¾å“­å“­è®Šé–‹å¿ƒã€‚</li>
        <li>ç•¶é­”ç‰©è®Šæˆé–‹å¿ƒç‰ˆæœ¬ï¼Œå°±æœƒé›¢é–‹é»‘éœ§ï¼Œå›åˆ°æ˜Ÿæ˜Ÿç‹åœ‹ã€‚</li>
        <li>å…¨éƒ¨ä¹å®®æ ¼é€šé—œå¾Œï¼Œå°±æœƒè§£é–é­”ç‹é»‘éœ§å·¨é¾ã€‚</li>
      </ul>
    </div>

    <!-- ğŸ§Ÿ é­”ç‰©åœ–é‘‘ï¼ˆç°¡æ˜“ç‰ˆï¼‰ -->
    <div id="page-monsters" class="page">
      <h3>ğŸ§Ÿ é­”ç‰©åœ–é‘‘ï¼ˆç¯€éŒ„ï¼‰</h3>
      <ul>
        <li>å“­å“­å²èŠå§†ï¼ˆRockï¼ä¸èƒ½å‡ºå¸ƒï¼‰</li>
        <li>æš´èºç«çƒï¼ˆRockï¼ä¸èƒ½å‡ºå¸ƒï¼‰</li>
        <li>å£å¿ƒæƒ…å—ç“œï¼ˆRockï¼ä¸èƒ½å‡ºå¸ƒï¼‰</li>
        <li>å“­å“­è‡è‡ï¼ˆPaperï¼ä¸èƒ½å‡ºå‰ªåˆ€ï¼‰</li>
        <li>æ‚²å‚·éª·é«ï¼ˆRockï¼ä¸èƒ½å‡ºå¸ƒï¼‰</li>
        <li>é»é»å²èŠå§†ï¼ˆRockï¼ä¸èƒ½å‡ºå¸ƒï¼‰</li>
        <li>å…‡æš´ç‹¼äººï¼ˆRockï¼ä¸èƒ½å‡ºå¸ƒï¼‰</li>
        <li>å°æƒ¡é­”ï¼ˆRockï¼ä¸èƒ½å‡ºå‰ªåˆ€ï¼‰</li>
        <li>æ†‚é¬±å¹½éˆï¼ˆPaperï¼ä¸èƒ½å‡ºçŸ³é ­ï¼‰</li>
        <li>é­”ç‹ï¼é»‘éœ§å·¨é¾ï¼ˆScissorsï¼ä¸èƒ½å‡ºçŸ³é ­ï¼‰</li>
      </ul>
    </div>

    <!-- âš™ï¸ è¨­å®š / èªªæ˜ -->
    <div id="page-settings" class="page">
      <h3>âš™ï¸ è¨­å®š / å®¶é•·å°è¦½</h3>
      <p>
        é€™æ˜¯ä¸€æ¬¾çµåˆã€Œæƒ…ç·’æ•™è‚²ã€èˆ‡ã€Œå‰ªåˆ€çŸ³é ­å¸ƒã€çš„è¼•é‡éŠæˆ²ï¼Œ
        é©åˆè¦ªå­ä¸€èµ·ç©ï¼Œå»ºè­°å¹´é½¡ç´„ 5 æ­²ä»¥ä¸Šã€‚
      </p>
      <ul>
        <li>å¯æ­é…çœŸå¯¦å¡ç‰Œï¼æ¡ŒéŠä¸€èµ·ä½¿ç”¨ã€‚</li>
        <li>å»ºè­°éŠæˆ²å¾Œå’Œå­©å­èŠèŠï¼š<br>
          ã€Œå“ªä¸€éš»é­”ç‰©è·Ÿä½ å¾ˆåƒï¼Ÿã€<br>
          ã€Œä½ æœ€è¿‘æœ‰å‡ºç¾ä»€éº¼å£æƒ…ç·’å—ï¼Ÿã€</li>
        <li>è®“å­©å­çŸ¥é“ï¼šæ‰€æœ‰æƒ…ç·’éƒ½å¯ä»¥è¢«çœ‹è¦‹èˆ‡å®‰æ’«ã€‚</li>
      </ul>

      <p class="mono">
        â€» æœ¬é å·²æ•´åˆï¼šé¸è§’ã€ä¹å®®æ ¼åœ°åœ–ã€å–®å ´æˆ°é¬¥ã€<br>
        æ„›çš„åŠ›é‡èªå¥ã€å‹‡æ°£æ˜Ÿæ˜Ÿèªå¥ã€é€šé—œé€£ç·šåˆ¤å®šã€<br>
        ä»¥åŠã€Œä¹å®®æ ¼é€šé—œ â†’ é­”ç‹æˆ°ã€æµç¨‹ã€‚<br>
        ç¾åœ¨å†åŠ å…¥ã€Œå–®äººï¼åŒæ©Ÿé›™äººæ¨¡å¼ã€ä»‹é¢ã€‚
      </p>
    </div>
  </div>
</div>

<script>
  // =========================
  // ğŸ”¹ æ¨¡å¼é¸æ“‡ï¼ˆå–®äºº / åŒæ©Ÿé›™äººï¼‰
  // =========================
  let currentMode = 'single'; // 'single' æˆ– 'local2p'
  const modeBtns = document.querySelectorAll('.mode-btn');
  const modeBanner = document.getElementById('modeBanner');

  function updateModeBanner() {
    if (currentMode === 'single') {
      modeBanner.innerHTML =
        'ç›®å‰æ¨¡å¼ï¼š<b>å–®äººå†’éšª</b>ï¼ˆä¸€å€‹äººç·´ç¿’èˆ‡é­”ç‰©äº’å‹•ï¼‰';
    } else {
      modeBanner.innerHTML =
        'ç›®å‰æ¨¡å¼ï¼š<b>åŒæ©Ÿé›™äºº</b>ï¼ˆå…©ä½å°å‹‡è€…è¼ªæµæ“ä½œï¼Œé©åˆè¦ªå­æˆ–æœ‹å‹ï¼‰';
    }
  }

  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      currentMode = btn.dataset.mode;
      modeBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      updateModeBanner();
    });
  });

  updateModeBanner();

  // =========================
  // èªå¥è³‡æ–™ï¼šæ„›çš„åŠ›é‡ & å‹‡æ°£æ˜Ÿæ˜Ÿ
  // =========================
  const loveSentences = [
    "ä½ ä¸éœ€è¦å®Œç¾ï¼Œä¹Ÿå€¼å¾—è¢«å¥½å¥½æ„›è‘—ã€‚",
    "å“­ä¸€å“­ä¹Ÿæ²’é—œä¿‚ï¼Œæˆ‘æœƒåœ¨é€™è£¡é™ªä½ ã€‚",
    "ç•¶ä½ èªªå‡ºå¿ƒè£¡è©±çš„æ™‚å€™ï¼Œä½ å°±å¾ˆå‹‡æ•¢ã€‚",
    "ç”Ÿæ°£çš„ä½ ã€é›£éçš„ä½ ï¼Œæˆ‘éƒ½ä¸€æ¨£å–œæ­¡ã€‚",
    "ä½ é¡˜æ„å†è©¦ä¸€æ¬¡ï¼Œå·²ç¶“è¶…æ£’äº†ã€‚",
    "ä½ ä¸æ˜¯ä¸€å€‹äººï¼Œæˆ‘å€‘ä¸€èµ·æƒ³è¾¦æ³•ã€‚",
    "æ¯ä¸€ç¨®æƒ…ç·’éƒ½åœ¨æé†’ä½ ï¼šä½ å¾ˆé‡è¦ã€‚",
    "ä»Šå¤©çš„ä½ ï¼Œå·²ç¶“å¾ˆåŠªåŠ›ç…§é¡§è‡ªå·±äº†ã€‚",
    "éœ€è¦ä¼‘æ¯çš„æ™‚å€™ï¼Œåœä¸‹ä¾†ä¹Ÿå¯ä»¥å–”ã€‚",
    "ä½ å¯ä»¥æ…¢æ…¢ä¾†ï¼Œä¸–ç•Œä¸æœƒæŠŠä½ ä¸Ÿä¸‹ã€‚",
    "å°±ç®—äº‹æƒ…æ²’ç…§è¨ˆç•«èµ°ï¼Œä½ çš„åƒ¹å€¼ä¸æœƒè®Šã€‚",
    "ä½ é¡˜æ„æ±‚åŠ©ï¼Œå°±æ˜¯å¾ˆå¤§çš„å‹‡æ°£ã€‚",
    "ç•¶ä½ æº«æŸ”å°å¾…è‡ªå·±æ™‚ï¼Œä¸–ç•Œä¹Ÿæœƒè®Šæº«æŸ”ã€‚",
    "ä½ å¿ƒè£¡çš„å°å°è²éŸ³ï¼Œæˆ‘éƒ½æœ‰åœ¨è½ã€‚",
    "æœ‰æ™‚å€™è¿·è·¯ï¼Œæ‰æœƒç™¼ç¾æ–°çš„é¢¨æ™¯ã€‚",
    "ä½ çš„çœ¼æ·šä¸æ˜¯éº»ç…©ï¼Œè€Œæ˜¯éœ€è¦è¢«çœ‹è¦‹çš„è¨Šè™Ÿã€‚",
    "ä½ ç¾åœ¨çš„æ¨£å­ï¼Œå°±è¶³å¤ å¯æ„›äº†ã€‚",
    "ä¸é–‹å¿ƒçš„æ™‚å€™ä¹Ÿå¯ä»¥è¢«å–œæ­¡ï¼ŒçœŸçš„å¯ä»¥ã€‚",
    "ä½ é¡˜æ„åœ¨é€™è£¡ï¼Œå°±æ˜¯ä¸€ä»¶å€¼å¾—è¢«æ“æŠ±çš„äº‹ã€‚",
    "ä½ å·²ç¶“åšå¾—å¾ˆå¥½ï¼Œä¸ç”¨è·Ÿåˆ¥äººæ¯”ã€‚",
    "ä¸ç”¨è£ä½œæ²’äº‹ï¼Œæœ‰äº‹æˆ‘å€‘ä¸€èµ·é¢å°ã€‚",
    "ä½ å¯ä»¥èªªã€Œæˆ‘éœ€è¦æŠ±æŠ±ã€ï¼Œé€™å¾ˆå‹‡æ•¢ã€‚",
    "ç•¶ä½ ç…§é¡§è‡ªå·±æ™‚ï¼Œä¹Ÿæ˜¯å°ä¸–ç•Œçš„ä¸€ç¨®æº«æŸ”ã€‚",
    "å°å°çš„ä½ ï¼Œä¹Ÿæœ‰å¤§å¤§çš„å½±éŸ¿åŠ›ã€‚",
    "ä½ æ¯ä¸€æ¬¡åŠªåŠ›ï¼Œæ„›éƒ½æœƒé»˜é»˜è¨˜å¾—ã€‚",
    "å°±ç®—è¢«èª¤è§£ï¼Œä¹Ÿä¸ä»£è¡¨ä½ æ˜¯ä¸å¥½çš„å­©å­ã€‚",
    "ä½ å¯ä»¥æ…¢æ…¢é•·å¤§ï¼Œä¸ç”¨æ€¥è‘—è®Šå²å®³ã€‚",
    "ä½ å€¼å¾—è¢«å¥½å¥½å‚¾è½ï¼Œä¸åªæ˜¯è¢«æ•™è¨“ã€‚",
    "ç•¶ä½ é¡˜æ„åŸè«’è‡ªå·±æ™‚ï¼Œå¿ƒæœƒè®Šå¾—æ¯”è¼ƒè¼•ã€‚",
    "ä½ æ˜¯ç¨ä¸€ç„¡äºŒçš„ç¦®ç‰©ï¼Œä¸–ç•Œå› ä½ è€Œä¸åŒã€‚"
  ];

  const courageSentences = [
    "å‹‡æ°£ä¸æ˜¯ä¸å®³æ€•ï¼Œè€Œæ˜¯å®³æ€•é‚„æ˜¯é¡˜æ„è©¦è©¦çœ‹ã€‚",
    "ä½ ä»Šå¤©è·¨å‡ºçš„å°å°ä¸€æ­¥ï¼Œéƒ½æ˜¯å¤§å¤§çš„é€²æ­¥ã€‚",
    "å¤±æ•—ä¸€æ¬¡ä¸ä»£è¡¨çµæŸï¼Œåªä»£è¡¨åœ¨ç·´ç¿’ã€‚",
    "æ¯ç•¶ä½ èªªã€Œæˆ‘æƒ³å†è©¦ä¸€æ¬¡ã€ï¼Œå‹‡æ°£æ˜Ÿæ˜Ÿå°±äº®èµ·ä¾†ã€‚",
    "é¡˜æ„æ‰¿èªã€Œæˆ‘ä¸æ‡‚ã€ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç¨®è¶…ç´šå‹‡æ•¢ã€‚",
    "ç•¶ä½ ä¿è­·è‡ªå·±å’Œåˆ¥äººçš„ç•Œç·šï¼Œä½ å°±æ˜¯å°å°å®ˆè­·è€…ã€‚",
    "èªªå‡ºã€Œæˆ‘ä¸å–œæ­¡é€™æ¨£ã€ï¼Œä¹Ÿæ˜¯å‹‡æ°£çš„è¶…èƒ½åŠ›ã€‚",
    "æ¯ç•¶ä½ é¸æ“‡æº«æŸ”è€Œä¸æ˜¯å‚·å®³ï¼Œä½ å°±åœ¨ç™¼å…‰ã€‚",
    "å®³æ€•æ™‚é¡˜æ„æ±‚æ•‘ï¼Œæ˜¯å‹‡è€…æ‰æœƒåšçš„äº‹ã€‚",
    "ä½ é¡˜æ„ç‚ºé‡è¦çš„äººå¤šèµ°ä¸€æ­¥ï¼Œå°±æ˜¯æ„›çš„å‹‡æ°£ã€‚",
    "é¢å°è‡ªå·±çš„æƒ…ç·’ï¼Œæ¯”é¢å°æ€ªç‰©é‚„è¦å²å®³ã€‚",
    "æ¯ä¸€æ¬¡é¼“èµ·å‹‡æ°£èªªã€Œå¯ä»¥å¹«å¹«æˆ‘å—ã€ï¼Œæ˜Ÿæ˜Ÿå°±æœƒç‚ºä½ æ‹æ‰‹ã€‚",
    "ç•¶ä½ æ›¿åˆ¥äººèªªå¥å…¬é“è©±ï¼Œä½ å°±æ˜¯æ­£ç¾©çš„å°å‹‡è€…ã€‚",
    "ä¸æ”¾æ£„çš„ä½ ï¼Œé æ¯”è‡ªå·±æƒ³åƒä¸­æ›´å¼·å¤§ã€‚",
    "é“æ­‰ä¸¦ä¸ä¸Ÿè‡‰ï¼Œè€Œæ˜¯å¿ƒè®Šå¾—æ›´æŸ”è»Ÿçš„è­‰æ˜ã€‚",
    "ç•¶ä½ é¡˜æ„åŸè«’è‡ªå·±ï¼Œå°±æœ‰èƒ½åŠ›æ“æŠ±åˆ¥äººã€‚",
    "å‹‡æ°£æ˜Ÿæ˜Ÿèªªï¼šã€Œæ…¢æ…¢ä¾†ä¹Ÿæ²’é—œä¿‚ï¼Œåªè¦ä½ é‚„åœ¨è·¯ä¸Šã€‚ã€",
    "ä»Šå¤©åŠªåŠ›æ´»è‘—çš„ä½ ï¼Œæœ¬èº«å°±æ˜¯è¶…ç´šä»»å‹™å®Œæˆã€‚",
    "ä½ å­¸æœƒå‘å‰ï¼Œä¹Ÿå­¸æœƒå¾Œé€€ä¸€æ­¥çœ‹æ›´æ¸…æ¥šã€‚",
    "ä¸ç®¡çµæœå¦‚ä½•ï¼Œä½ é¡˜æ„åƒèˆ‡ï¼Œå°±å·²ç¶“å¾ˆå€¼å¾—è¢«ç¨±è®šã€‚"
  ];

  function pickRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // =========================
  // Monster è¨­å®šï¼ˆå¤©è³¦æ‹³ï¼ä¸èƒ½å‡ºæ‹³ï¼‰
  // =========================
  const monstersConfig = {
    "å“­å“­å²èŠå§†": { talent: "rock", forbidden: "paper" },
    "æš´èºç«çƒ": { talent: "rock", forbidden: "paper" },
    "å£å¿ƒæƒ…å—ç“œ": { talent: "rock", forbidden: "paper" },
    "å“­å“­è‡è‡": { talent: "paper", forbidden: "scissors" },
    "æ‚²å‚·éª·é«": { talent: "rock", forbidden: "paper" },
    "é»é»å²èŠå§†": { talent: "rock", forbidden: "paper" },
    "å…‡æš´ç‹¼äºº": { talent: "rock", forbidden: "paper" },
    "å°æƒ¡é­”": { talent: "rock", forbidden: "scissors" },
    "æ†‚é¬±å¹½éˆ": { talent: "paper", forbidden: "rock" },
    // é­”ç‹é—œå¡
    "é­”ç‹ï¼é»‘éœ§å·¨é¾": { talent: "scissors", forbidden: "rock", boss: true }
  };

  function fistToText(fist) {
    if (fist === "rock") return "çŸ³é ­ âœŠ";
    if (fist === "paper") return "å¸ƒ ğŸ–";
    if (fist === "scissors") return "å‰ªåˆ€ âœŒï¸";
    return "â€”";
  }

  function forbiddenText(fist) {
    if (fist === "rock") return "ä¸èƒ½å‡ºã€ŒçŸ³é ­ âœŠã€";
    if (fist === "paper") return "ä¸èƒ½å‡ºã€Œå¸ƒ ğŸ–ã€";
    if (fist === "scissors") return "ä¸èƒ½å‡ºã€Œå‰ªåˆ€ âœŒï¸ã€";
    return "æœ‰é»ç¥ç¥•ï¼Œçœ‹ä¸å‡ºå¼±é»â€¦";
  }

  // =========================
  // Tabs åˆ†é åˆ‡æ›
  // =========================
  const navButtons = document.querySelectorAll('.nav-btn');
  const pages = document.querySelectorAll('.page');

  function showPage(id) {
    pages.forEach(p => {
      p.classList.toggle('active', p.id === id);
    });
  }

  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.target;
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      showPage(target);
    });
  });

  // =========================
  // å°å‹‡è€…é¸æ“‡
  // =========================
  let currentHero = null;
  let currentHeroTalent = null;
  const heroCards = document.querySelectorAll('.hero-card');
  const currentHeroBox = document.getElementById('currentHero');

  heroCards.forEach(card => {
    card.addEventListener('click', () => {
      heroCards.forEach(c => c.classList.remove('active'));
      card.classList.add('active');

      const name = card.dataset.hero;
      const fist = card.dataset.fist;
      const line = card.dataset.line;

      currentHero = name;
      currentHeroTalent = fist;

      let talentText = "ä»»æ„æ‹³";
      if (fist === "rock") talentText = "çŸ³é ­ âœŠ";
      if (fist === "paper") talentText = "å¸ƒ ğŸ–";
      if (fist === "scissors") talentText = "å‰ªåˆ€ âœŒï¸";

      currentHeroBox.innerHTML = `
        ç›®å‰é¸æ“‡çš„å°å‹‡è€…ï¼š<b>${name}</b><br>
        æ‹›ç‰Œæ‹³æ³•ï¼š${talentText}<br>
        å£é ­ç¦ªï¼š${line}
      `;
    });
  });

  function goToHome() {
    const btn = document.querySelector('.nav-btn[data-target="page-home"]');
    if (btn) {
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    showPage('page-home');
  }

  function goToMap() {
    const btn = document.querySelector('.nav-btn[data-target="page-map"]');
    if (btn) {
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    showPage('page-map');
  }

  // =========================
  // ä¹å®®æ ¼åœ°åœ–é¸æ“‡ & é€šé—œç´€éŒ„
  // =========================
  let currentStage = null;
  let currentMonster = null;
  const mapCells = document.querySelectorAll('.map-cell');
  const currentStageBox = document.getElementById('currentStage');

  const clearedStages = Array(9).fill(false);
  const lines = [
    [0,1,2], [3,4,5], [6,7,8], // æ©«æ’
    [0,3,6], [1,4,7], [2,5,8], // ç›´æ’
    [0,4,8], [2,4,6]           // æ–œç·š
  ];
  const lineCompleted = Array(lines.length).fill(false);

  let bossUnlocked = false;
  let bossDefeated = false;
  const BOSS_NAME = "é­”ç‹ï¼é»‘éœ§å·¨é¾";

  mapCells.forEach(cell => {
    cell.addEventListener('click', () => {
      mapCells.forEach(c => c.classList.remove('active'));
      cell.classList.add('active');

      currentStage = parseInt(cell.dataset.stage, 10);
      currentMonster = cell.dataset.monster;

      currentStageBox.innerHTML = `
        ç›®å‰é¸æ“‡çš„åœ°é»ï¼š<b>ç¬¬ ${currentStage} æ ¼</b><br>
        å°æˆ°é­”ç‰©ï¼š<b>${currentMonster}</b><br>
        é»æ“Šã€Œé€²å…¥æˆ°é¬¥ï¼ã€å³å¯é–‹å§‹é€™ä¸€é—œã€‚<br>
        <span style="font-size:12px;color:#a0622a;">
          ç¾åœ¨æ¨¡å¼ï¼š${currentMode === 'single' ? 'å–®äººå†’éšªï¼ˆç”±ä½ å‡ºæ‹³ï¼‰' : 'åŒæ©Ÿé›™äººï¼ˆå¯ä»¥è¼ªæµå‡ºæ‹³ï¼‰'}
        </span>
      `;
    });
  });

  function onMonsterCalmed(stageNumber) {
    const idx = stageNumber - 1;
    if (!clearedStages[idx]) {
      clearedStages[idx] = true;
      const cell = document.querySelector(`.map-cell[data-stage="${stageNumber}"]`);
      if (cell && !cell.querySelector('.cleared-star')) {
        const star = document.createElement('div');
        star.className = 'cleared-star';
        star.textContent = 'â­ å·²é€šé—œ';
        cell.appendChild(star);
      }
    }

    const loveBox = document.getElementById('loveMessage');
    loveBox.textContent = 'ğŸ’— æ„›çš„åŠ›é‡èªå¥ï¼š' + pickRandom(loveSentences);

    const newly = checkNewLines();
    if (newly > 0) {
      const courageBox = document.getElementById('courageMessage');
      courageBox.textContent = 'â­ å‹‡æ°£æ˜Ÿæ˜Ÿèªå¥ï¼š' + pickRandom(courageSentences);
    }

    // âœ… æª¢æŸ¥æ˜¯å¦ä¹å®®æ ¼å…¨éƒ¨é€šé—œ â†’ è§£é–é­”ç‹é—œå¡
    if (!bossUnlocked && clearedStages.every(v => v)) {
      bossUnlocked = true;
      alert("ğŸŒŸ æ­å–œï¼ä¹å®®æ ¼å…¨éƒ¨é€šé—œï¼\né»‘éœ§çš„æºé ­æ­£åœ¨ç”¦é†’ï¼Œæº–å‚™æŒ‘æˆ°é­”ç‹é»‘éœ§å·¨é¾ï¼");
      startBossBattle();
    }
  }

  function checkNewLines() {
    let newly = 0;
    lines.forEach((line, index) => {
      if (!lineCompleted[index]) {
        const ok = line.every(i => clearedStages[i]);
        if (ok) {
          lineCompleted[index] = true;
          newly++;
        }
      }
    });
    return newly;
  }

  // =========================
  // æˆ°é¬¥ç•«é¢é‚è¼¯ï¼ˆä¸€èˆ¬é—œå¡ & é­”ç‹é—œå¡ï¼‰
  // =========================
  const battleHeroName = document.getElementById('battleHeroName');
  const battleHeroTalent = document.getElementById('battleHeroTalent');
  const battleMonsterName = document.getElementById('battleMonsterName');
  const battleMonsterInfo = document.getElementById('battleMonsterInfo');
  const battleModeLabel = document.getElementById('battleModeLabel');
  const bearTip = document.getElementById('bearTip');
  const battleResultBox = document.getElementById('battleResult');

  const btnRock = document.getElementById('btn-rock');
  const btnScissors = document.getElementById('btn-scissors');
  const btnPaper = document.getElementById('btn-paper');

  let isBossBattle = false;

  function highlightHeroTalentButton() {
    [btnRock, btnScissors, btnPaper].forEach(btn => btn.classList.remove('hero-talent'));
    if (currentHeroTalent === 'rock') btnRock.classList.add('hero-talent');
    if (currentHeroTalent === 'scissors') btnScissors.classList.add('hero-talent');
    if (currentHeroTalent === 'paper') btnPaper.classList.add('hero-talent');
    // anyï¼šä¸ç‰¹åˆ¥æ¨™
  }

  function setupBattle() {
    if (!currentHero) {
      battleResultBox.textContent = 'è«‹å…ˆåœ¨ã€Œé¸æ“‡å°å‹‡è€…ã€é é¢é¸ä¸€å€‹è§’è‰²ã€‚';
      return;
    }

    let monsterName = currentMonster;
    if (isBossBattle) {
      monsterName = BOSS_NAME;
    }

    const config = monstersConfig[monsterName] || { talent: 'rock', forbidden: null };

    battleHeroName.textContent = currentHero;
    if (currentHeroTalent === 'any') {
      battleHeroTalent.textContent = 'æ‹›ç‰Œæ‹³ï¼šä»»æ„æ‹³ï¼ˆé­”ç‹æˆ°æ‰ç™¼å‹•ç‰¹æ®Šæ•ˆæœï¼‰';
    } else {
      battleHeroTalent.textContent = 'æ‹›ç‰Œæ‹³ï¼š' + fistToText(currentHeroTalent);
    }

    battleMonsterName.textContent = monsterName;
    battleMonsterInfo.textContent =
      'å¤©è³¦ï¼š' + fistToText(config.talent) +
      ' ï¼ å¼±é»ï¼š' + (config.forbidden ? forbiddenText(config.forbidden) : 'æœªçŸ¥');

    // é¡¯ç¤ºæ¨¡å¼æ–‡å­—
    if (isBossBattle) {
      const modeText = currentMode === 'local2p'
        ? 'æœ€çµ‚é­”ç‹æˆ°ï¼ˆåŒæ©Ÿé›™äººï¼Œå¯è¼ªæµå‡ºæ‹³ï¼‰'
        : 'æœ€çµ‚é­”ç‹æˆ°';
      battleModeLabel.textContent = 'æ¨¡å¼ï¼š' + modeText;

      bearTip.textContent =
        'ğŸ§¸ æ‘é•·ç†Šç†Šæç¤ºï¼šé»‘éœ§å·¨é¾çš„å¿ƒè£¡è—è‘—å¾ˆå¤šå§”å±ˆèˆ‡ç”Ÿæ°£ï¼Œ' +
        'è¨˜å¾—ç”¨ä½ çš„æ‹›ç‰Œæ‹³èˆ‡æ„›çš„åŠ›é‡æ…¢æ…¢å®‰æ’«ç‰ ã€‚' +
        (currentMode === 'local2p'
          ? ' ä¹Ÿå¯ä»¥å…©ä½å°å‹‡è€…è¼ªæµèªªå‡ºä¸€å¥é¼“å‹µçš„è©±ï¼Œå†å‡ºæ‹³å–”ã€‚'
          : '');
      battleResultBox.textContent =
        'é€™æ˜¯æœ€çµ‚é—œå¡ï¼è«‹é¸æ“‡è¦å‡ºçš„æ‹³ï¼Œè©¦è‘—è®“é»‘éœ§å·¨é¾ä¹Ÿéœ²å‡ºç¬‘å®¹ã€‚';
    } else {
      const modeText = currentMode === 'local2p'
        ? 'ä¸€èˆ¬é—œå¡ï¼ˆåŒæ©Ÿé›™äººï¼Œå¯è¼ªæµå‡ºæ‹³ï¼‰'
        : 'ä¸€èˆ¬é—œå¡';
      battleModeLabel.textContent = 'æ¨¡å¼ï¼š' + modeText;

      bearTip.textContent =
        'ğŸ§¸ æ‘é•·ç†Šç†Šæç¤ºï¼šé€™éš»é­”ç‰© ' +
        (config.forbidden ? forbiddenText(config.forbidden) : 'æœ‰é»ç¥ç¥•ï¼Œè§€å¯Ÿç‰ çš„å‡ºæ‹³å§ï¼') +
        (currentMode === 'local2p'
          ? ' å¯ä»¥è®“ç©å®¶ä¸€ã€ç©å®¶äºŒè¼ªæµå‡ºæ‹³å’Œèªªæ„Ÿå—ã€‚'
          : '');
      battleResultBox.textContent =
        'è«‹é¸æ“‡è¦å‡ºçš„æ‹³ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å®‰æ’«ç‰ çš„å¿ƒæƒ…ã€‚';
    }

    highlightHeroTalentButton();
  }

  function randomMonsterMove(config) {
    const all = ['rock', 'paper', 'scissors'];
    const allowed = config.forbidden ? all.filter(f => f !== config.forbidden) : all;
    const pool = [...allowed, config.talent];
    return pool[Math.floor(Math.random() * pool.length)];
  }

  function decideResult(player, monster) {
    if (player === monster) return 'draw';
    if (
      (player === 'rock' && monster === 'scissors') ||
      (player === 'scissors' && monster === 'paper') ||
      (player === 'paper' && monster === 'rock')
    ) return 'win';
    return 'lose';
  }

  function playerChoose(playerMove) {
    if (!currentHero) {
      battleResultBox.textContent = 'è«‹å…ˆé¸æ“‡å°å‹‡è€…å†é€²è¡Œæˆ°é¬¥ã€‚';
      return;
    }

    let monsterName = currentMonster;
    if (isBossBattle) {
      monsterName = BOSS_NAME;
    }
    const config = monstersConfig[monsterName] || { talent: 'rock', forbidden: null };

    const monsterMove = randomMonsterMove(config);
    const result = decideResult(playerMove, monsterMove);

    let txt = `ä½ å‡ºäº† ${fistToText(playerMove)}ï¼Œé­”ç‰©å‡ºäº† ${fistToText(monsterMove)}ã€‚\n`;

    if (result === 'win') {
      let talentBonus = '';
      if (!isBossBattle && currentHeroTalent !== 'any' && playerMove === currentHeroTalent) {
        talentBonus = '\nâœ¨ è§¸ç™¼å°å‹‡è€…æ‹›ç‰Œæ‹³ï¼é€™æ¬¡çš„å¥½å¿ƒæƒ…æ•ˆæœåŠ å€ï¼';
      }
      if (isBossBattle && currentHero === 'å‹‡æ•¢çš„æ‘æ°‘') {
        talentBonus += '\nğŸŒ¾ å‹‡æ•¢çš„æ‘æ°‘åœ¨é­”ç‹æˆ°ç™¼å‹•çœŸæœ¬äº‹ï¼šå°±ç®—æ›¾ç¶“å®³æ€•ï¼Œä¹Ÿé¡˜æ„ç«™å‡ºä¾†é¢å°ï¼';
      }

      if (isBossBattle) {
        bossDefeated = true;
        battleResultBox.textContent =
          txt +
          'ğŸŒˆ ä½ æˆåŠŸå®‰æ’«äº†é»‘éœ§å·¨é¾çš„å¿ƒï¼Œç‰ çµ‚æ–¼åœæ­¢æ€’å¼ï¼Œ\n' +
          'é»‘éœ§æ…¢æ…¢æ•£å»ï¼Œæ˜Ÿæ˜Ÿç‹åœ‹é‡æ–°äº®èµ·æº«æš–çš„å…‰èŠ’ï¼\n\n' +
          'ğŸ‘‘ æ­å–œä½ å®Œæˆæœ€çµ‚é­”ç‹é—œå¡ï¼\n' +
          'ï¼ˆä½ ä¹Ÿå¯ä»¥å’Œå­©å­èŠèŠï¼šã€Œé»‘éœ§å·¨é¾å¿ƒè£¡ï¼Œå…¶å¯¦åœ¨é›£éä»€éº¼å‘¢ï¼Ÿã€ï¼‰' +
          talentBonus;
      } else {
        battleResultBox.textContent =
          txt +
          'âœ… ä½ æˆåŠŸå®‰æ’«äº†é­”ç‰©çš„å¿ƒæƒ…ï¼Œç‰ éœ²å‡ºäº†å¾®ç¬‘ï¼Œå¾é»‘éœ¾ä¸­èµ°å‡ºä¾†äº†ï¼' +
          talentBonus;
        onMonsterCalmed(currentStage);
      }

    } else if (result === 'draw') {
      battleResultBox.textContent =
        txt + 'ğŸ¤ å¹³æ‰‹ï¼é­”ç‰©é‚„åœ¨çŒ¶è±«ä¸­ï¼Œå†è©¦ä¸€æ¬¡çœ‹çœ‹å§ã€‚';
    } else {
      let extra = '\nåŠ æ²¹ï¼Œä½ å·²ç¶“å¾ˆå‹‡æ•¢äº†ï¼Œå¯ä»¥å†è§€å¯Ÿä¸€ä¸‹ç‰ çš„å¼±é»å–”ã€‚';
      if (isBossBattle && currentHero === 'å‹‡æ•¢çš„æ‘æ°‘') {
        extra += '\nğŸŒ¾ å‹‡æ•¢çš„æ‘æ°‘ç¥•æŠ€ï¼šå³ä½¿è¢«æ‰“æ•—å¹¾æ¬¡ï¼Œä¹Ÿä¸æœƒè¢«å£æƒ…ç·’æ‰“å€’ã€‚';
      }
      if (currentMode === 'local2p') {
        extra += '\nğŸ‘¥ å¯ä»¥æ›å¦ä¸€ä½å°å‹‡è€…å‡ºæ‹³ï¼Œé †ä¾¿èªªèªªè‡ªå·±å¿ƒè£¡çš„æ„Ÿè¦ºã€‚';
      }
      battleResultBox.textContent =
        txt + 'ğŸ’¦ é€™å›åˆä½ æœ‰é»åƒè™§ï¼Œé­”ç‰©çš„å£æƒ…ç·’é‚„æ²’è¢«å®‰æ’«ã€‚' + extra;
    }
  }

  function backToMap() {
    if (bossDefeated) {
      alert("ğŸ‰ ä½ å·²ç¶“æ‰“å®Œé­”ç‹ï¼Œå¯ä»¥å›ä¹å®®æ ¼çœ‹çœ‹æ‰€æœ‰ä»»å‹™ï¼Œæˆ–é‡æ–°æŒ‘æˆ°å–œæ­¡çš„é—œå¡ã€‚");
    }
    goToMap();
  }

  // ä¸€èˆ¬é—œå¡ï¼šå¾åœ°åœ–é€²å…¥æˆ°é¬¥
  function startGameFromMap() {
    if (!currentHero) {
      alert("è«‹å…ˆåœ¨ã€Œé¸æ“‡å°å‹‡è€…ã€é é¢é¸ä¸€å€‹è§’è‰²ï¼Œå†é–‹å§‹å†’éšªï¼");
      return;
    }
    if (!currentStage || !currentMonster) {
      alert("è«‹å…ˆåœ¨ä¹å®®æ ¼åœ°åœ–ä¸­é¸æ“‡ä¸€æ ¼è¦æŒ‘æˆ°çš„é—œå¡ï¼");
      return;
    }
    isBossBattle = false;
    showPage('page-battle');
    const btn = document.querySelector('.nav-btn[data-target="page-battle"]');
    if (btn) {
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    setupBattle();
  }

  // é­”ç‹æˆ°ï¼šä¹å®®æ ¼å…¨éƒ¨é€šé—œå¾Œè‡ªå‹•å•Ÿå‹•
  function startBossBattle() {
    isBossBattle = true;
    currentMonster = BOSS_NAME;
    currentStage = null; // ä¸å†å°æ‡‰ä¹å®®æ ¼
    showPage('page-battle');
    const btn = document.querySelector('.nav-btn[data-target="page-battle"]');
    if (btn) {
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    setupBattle();
  }
</script>

</body>
</html>